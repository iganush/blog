<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
  <title><%= blog.title %> | Blog</title>
  <style>
    body { background-color: #fcfcfc; font-family: 'Inter', sans-serif; color: #1f2937; }
    
    .blog-header { max-width: 800px; margin: 60px auto 30px; }
    .blog-title { font-size: 2.8rem; font-weight: 800; color: #111827; line-height: 1.2; margin-bottom: 25px; }
    
    /* Author Section Styling */
    .author-badge { 
      display: flex; 
      align-items: center; 
      gap: 15px; 
      padding: 10px 0;
      margin-bottom: 30px;
      border-top: 1px solid #eee;
      border-bottom: 1px solid #eee;
    }
    .author-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .author-details { display: flex; flex-direction: column; }
    .author-name { font-weight: 700; color: #6366f1; font-size: 1.1rem; margin: 0; }
    .post-date { font-size: 0.85rem; color: #6b7280; }

    .featured-image { width: 100%; border-radius: 24px; margin-bottom: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); }
    .blog-content { font-size: 1.2rem; line-height: 1.9; color: #374151; white-space: pre-wrap; margin-bottom: 50px; }
    .delete-blog-form { margin-bottom: 30px; }

    /* Comment Box */
    .comment-section { background: #ffffff; border: 1px solid #e5e7eb; border-radius: 24px; padding: 35px; margin-top: 40px; }
    .comment-card { border-bottom: 1px solid #f3f4f6; padding: 20px 0; }
    .comment-card:last-child { border-bottom: none; }
  </style>
</head>

<body>
  <%- include('./partials/nav') %>

  <article class="container">
    <div class="blog-header">
      <h1 class="blog-title"><%= blog.title %></h1>
      
      <div class="author-badge">
        <img src="<%= blog.createdBy?.profileImageURL || '/images/default-avatar.png' %>" class="author-img" alt="Author">
        <div class="author-details">
          <p class="author-name">By <%= blog.createdBy?.fullName %></p>
          <span class="post-date">Published on <%= new Date(blog.createdAt).toLocaleDateString('en-US', { day: 'numeric', month: 'long', year: 'numeric' }) %></span>
        </div>
      </div>

      <% if (locals.user && blog.createdBy && String(blog.createdBy._id) === String(user._id)) { %>
        <form action="/blog/<%= blog._id %>/delete" method="post" class="delete-blog-form" onsubmit="return confirm('Are you sure you want to delete this blog?');">
          <button type="submit" class="btn btn-danger px-4">Delete Blog</button>
        </form>
      <% } %>

      <img src="<%= blog.coverImageURL %>" class="featured-image" alt="<%= blog.title %>">

      <div class="blog-content">
        <%= blog.body %>
      </div>

      <div class="p-4 bg-light rounded-4 d-flex align-items-center gap-3 mb-5">
        <img src="<%= blog.createdBy?.profileImageURL || '/images/default-avatar.png' %>" width="60" height="60" class="rounded-circle" alt="">
        <div>
          <h6 class="mb-0 fw-bold">About <%= blog.createdBy?.fullName %></h6>
          <p class="mb-0 text-muted small">Content Creator at Blogify</p>
        </div>
      </div>

      <hr>

      <section class="comment-section shadow-sm mb-5">
        <h4 class="fw-bold mb-4">Discussion (<%= comments.length %>)</h4>

        <% if (locals.user) { %>
          <form action="/blog/comment/<%= blog._id %>" method="post" class="mb-5">
            <textarea name="content" class="form-control border-0 bg-light p-3" rows="3" placeholder="Join the conversation..." style="border-radius: 15px;"></textarea>
            <div class="text-end mt-2">
              <button class="btn btn-primary px-4 fw-bold" type="submit" style="border-radius: 50px; background-color: #6366f1;">Post Comment</button>
            </div>
          </form>
        <% } %>

        <div class="comment-list">
          <% comments.forEach(comment => { %>
            <div class="comment-card">
              <div class="d-flex align-items-center gap-2 mb-2">
                <img src="<%= comment.createdBy?.profileImageURL || '/images/default-avatar.png' %>" class="rounded-circle" width="30" height="30" alt="">
                <span class="fw-bold small"><%= comment.createdBy?.fullName %></span>
              </div>
              <p class="text-muted mb-0 ps-4 ms-2 border-start"><%= comment.content %></p>
            </div>
          <% }) %>
        </div>
      </section>
    </div>
  </article>

  <%- include('./partials/scripts') %>
</body>
</html>
